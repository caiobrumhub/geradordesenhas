<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerador de Senhas</title>
  <style>
    :root { --bg:#0f1115; --card:#151923; --text:#e6e6e6; --muted:#9aa3b2; --accent:#6ea8fe; }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Inter,Arial; background:linear-gradient(135deg,#0f1115,#0c0f14); color:var(--text); min-height:100svh; display:grid; place-items:center;}
    .wrap{width:min(720px,92vw); margin:4rem auto;}
    .card{background:var(--card); border:1px solid #232836; border-radius:18px; padding:28px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{margin:0 0 10px; font-size:clamp(1.4rem,2.2vw,2rem)}
    p.sub{margin:.25rem 0 1.25rem; color:var(--muted)}
    .row{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    input[type="number"]{width:110px; padding:12px 14px; border-radius:12px; border:1px solid #2a2f3b; background:#0d111a; color:var(--text)}
    .btn{appearance:none; border:0; border-radius:12px; padding:12px 18px; font-weight:600; cursor:pointer; background:var(--accent); color:#0a0e17; transition:filter .15s ease}
    .btn:active{transform:translateY(1px)}
    .out{margin-top:16px; display:flex; gap:10px; align-items:center}
    .pw{flex:1; padding:12px 14px; border-radius:12px; border:1px solid #2a2f3b; background:#0b0f17; color:var(--text); font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .msg{margin-top:10px; min-height:1.5em; color:#7ee787}
    small.hint{display:block; color:var(--muted); margin-top:.5rem}
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card" aria-live="polite">
      <h1>Gerador de Senhas</h1>
      <p class="sub">Gere uma senha forte, copie automaticamente e pronto! ✨</p>

      <div class="row" role="group" aria-label="Opções de senha">
        <label for="len">Tamanho</label>
        <input id="len" type="number" min="8" max="64" value="12" />
        <label><input id="upper" type="checkbox" checked> A-Z</label>
        <label><input id="lower" type="checkbox" checked> a-z</label>
        <label><input id="digits" type="checkbox" checked> 0-9</label>
        <label><input id="symbols" type="checkbox" checked> !@#$…</label>
        <button id="gen" class="btn">Gerar senha</button>
      </div>

      <div class="out">
        <input id="pw" class="pw" type="text" readonly placeholder="Sua senha aparecerá aqui" />
        <button id="copy" class="btn" title="Copiar novamente">Copiar</button>
      </div>

      <div id="msg" class="msg" aria-live="assertive"></div>
      <small class="hint">Dica: mantenha o tamanho ≥ 12 e não reutilize senhas.</small>
    </section>
  </main>

  <script>
    const ui = {
      len: document.getElementById('len'),
      upper: document.getElementById('upper'),
      lower: document.getElementById('lower'),
      digits: document.getElementById('digits'),
      symbols: document.getElementById('symbols'),
      gen: document.getElementById('gen'),
      copy: document.getElementById('copy'),
      pw: document.getElementById('pw'),
      msg: document.getElementById('msg')
    };

    const alphaLower = 'abcdefghijklmnopqrstuvwxyz';
    const alphaUpper = alphaLower.toUpperCase();
    const nums = '0123456789';
    const syms = "!@#$%^&*()-_=+[]{};:,.<>/?";

    function getRandomInt(max){
      // Criptograficamente seguro quando possível
      const buf = new Uint32Array(1);
      if (window.crypto && crypto.getRandomValues){
        crypto.getRandomValues(buf);
        return buf[0] % max;
      }
      return Math.floor(Math.random()*max);
    }

    function shuffle(arr){
      for (let i=arr.length-1;i>0;i--){
        const j = getRandomInt(i+1);
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function generatePassword(len){
      const pools = [];
      if (ui.lower.checked) pools.push(alphaLower);
      if (ui.upper.checked) pools.push(alphaUpper);
      if (ui.digits.checked) pools.push(nums);
      if (ui.symbols.checked) pools.push(syms);

      if (pools.length === 0) pools.push(alphaLower); // fallback

      // garantir pelo menos 1 de cada pool selecionado
      const chars = [];
      for (const p of pools){
        chars.push(p[getRandomInt(p.length)]);
      }

      const all = pools.join('');
      while (chars.length < len){
        chars.push(all[getRandomInt(all.length)]);
      }
      return shuffle(chars).join('');
    }

    async function copyToClipboard(text){
      try{
        if (navigator.clipboard && window.isSecureContext){
          await navigator.clipboard.writeText(text);
          return true;
        }
      }catch(e){/* continua para fallback */}
      // Fallback
      const ta = document.createElement('textarea');
      ta.value = text; ta.setAttribute('readonly',''); ta.style.position='fixed'; ta.style.top='-9999px';
      document.body.appendChild(ta); ta.select();
      try{ document.execCommand('copy'); return true; } catch(e){ return false; }
      finally{ document.body.removeChild(ta); }
    }

    async function generateAndCopy(){
      const len = Math.max( parseInt(ui.len.value || '12', 10), 4 );
      const password = generatePassword(len);
      ui.pw.value = password;
      const ok = await copyToClipboard(password);
      ui.msg.textContent = ok ? 'senha gerada e copiada com sucesso' : 'senha gerada (não foi possível copiar automaticamente)';
    }

    ui.gen.addEventListener('click', generateAndCopy);
    ui.copy.addEventListener('click', async () => {
      if (!ui.pw.value) return;
      const ok = await copyToClipboard(ui.pw.value);
      ui.msg.textContent = ok ? 'senha copiada novamente' : 'não foi possível copiar automaticamente';
    });

    // Enter para gerar rapidamente
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter') generateAndCopy();
    });
  </script>
</body>
</html>
